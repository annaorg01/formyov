<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×˜×•×¤×¡ ×¤×™× ×•×™ ×‘× ×™×™×Ÿ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="3" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="70" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="30" r="2" fill="rgba(255,255,255,0.1)"/></svg>');
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        .form-container {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        .form-group input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .form-group input:hover {
            border-color: #667eea;
            background: white;
        }

        .phone-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border: 1px solid #e9ecef;
        }

        .phone-section h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-align: center;
        }

        .submit-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:active {
            transform: translateY(-1px);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .watermark {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 165, 0, 0.2);
            color: #ff8c00;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 500;
            backdrop-filter: blur(10px);
            z-index: 1000;
            pointer-events: none;
            user-select: none;
            border: 1px solid rgba(255, 165, 0, 0.3);
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
            }
            
            .form-container {
                padding: 20px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .watermark {
                font-size: 0.6rem;
                padding: 3px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://www.rosh-haayin.muni.il/content/images/logo.png" alt="" style="height: 40px; margin-bottom: 15px; filter: brightness(0) invert(1);">
            <h1>ğŸ¢ ×˜×•×¤×¡ ×¤×™× ×•×™ ×‘× ×™×™×Ÿ</h1>
            <p>×× × ××œ× ××ª ×”×¤×¨×˜×™× ×”×‘××™× ×‘××“×•×™×§</p>
        </div>
        
        <div class="form-container">
            <form id="evacuationForm">
                <div class="form-group">
                    <label for="idNumber">×ª×¢×•×“×ª ×–×”×•×ª</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="text" id="idNumber" name="idNumber" placeholder="×”×›× ×¡ ××¡×¤×¨ ×ª×¢×•×“×ª ×–×”×•×ª (5-9 ×¡×¤×¨×•×ª)" maxlength="9" required>
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 1.1rem; font-weight: 500;">
                            <input type="checkbox" id="isMissing" name="isMissing">
                            × ×¢×“×¨
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="name">×©×</label>
                    <input type="text" id="name" name="name" placeholder="×”×›× ×¡ ×©× ××œ×" required>
                </div>

                <div class="form-group">
                    <label for="street">×¨×—×•×‘</label>
                    <input type="text" id="street" name="street" placeholder="×”×›× ×¡ ×©× ×¨×—×•×‘" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="houseNumber">××¡×¤×¨ ×‘×™×ª</label>
                        <input type="text" id="houseNumber" name="houseNumber" placeholder="××¡×¤×¨ ×‘×™×ª" required>
                    </div>

                    <div class="form-group">
                        <label for="apartmentNumber">××¡×¤×¨ ×“×™×¨×”</label>
                        <input type="text" id="apartmentNumber" name="apartmentNumber" placeholder="××¡×¤×¨ ×“×™×¨×”">
                    </div>
                </div>

                <div class="form-group">
                    <label for="floor">×§×•××”</label>
                    <input type="text" id="floor" name="floor" placeholder="××¡×¤×¨ ×§×•××”">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="residents">××¡×¤×¨ × ×¤×©×•×ª ×‘×“×™×¨×”</label>
                        <input type="number" id="residents" name="residents" min="1" required>
                    </div>

                    <div class="form-group">
                        <label for="familyMissing">×‘×Ÿ ××©×¤×—×” × ×¢×“×¨?</label>
                        <select id="familyMissing" name="familyMissing" class="form-control">
                            <option value="false">×œ×</option>
                            <option value="true">×›×Ÿ</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="clothing">×ª×™××•×¨ ×œ×‘×•×©/××–×”×”</label>
                    <input type="text" id="clothing" name="clothing" class="form-control">
                </div>

                <div class="form-group">
                    <label for="additionalFamily">×‘× ×™ ××©×¤×—×” × ×•×¡×¤×™× ×©×œ× × ×›×—×•</label>
                    <input type="text" id="additionalFamily" name="additionalFamily" class="form-control">
                </div>

                <div class="phone-section">
                    <h3>ğŸ“ ×¤×¨×˜×™ ×§×©×¨</h3>
                    
                    <div class="form-group">
                        <label for="mobilePhone">×˜×œ×¤×•×Ÿ × ×™×™×“</label>
                        <input type="tel" id="mobilePhone" name="mobilePhone" placeholder="05X-XXXXXXX" required>
                    </div>

                    <div class="form-group">
                        <label for="homePhone">×˜×œ×¤×•×Ÿ ×‘×‘×™×ª</label>
                        <input type="tel" id="homePhone" name="homePhone" placeholder="0X-XXXXXXX">
                    </div>

                    <div class="form-group">
                        <label for="emergencyPhone">×˜×œ×¤×•×Ÿ ×—×™×¨×•×</label>
                        <input type="tel" id="emergencyPhone" name="emergencyPhone" placeholder="×˜×œ×¤×•×Ÿ ×œ×™×¦×™×¨×ª ×§×©×¨ ×‘×—×™×¨×•×">
                    </div>

                    <div class="form-group">
                        <label for="additionalPhone">×˜×œ×¤×•×Ÿ × ×•×¡×£</label>
                        <input type="tel" id="additionalPhone" name="additionalPhone" placeholder="×˜×œ×¤×•×Ÿ × ×•×¡×£ (××•×¤×¦×™×•× ×œ×™)">
                    </div>
                </div>

                <button type="submit" class="submit-btn">×©×œ×— ×˜×•×¤×¡ ğŸš€</button>
            </form>
        </div>
    </div>

    <div class="watermark">ğŸ¤– MADE WITH CODE-CAL</div>

    <script>
        const { appendToSheet, getRecordById } = require('./googleSheetsService.js');
        
        // Make functions available globally for form submission
        window.appendToSheet = appendToSheet;
        window.getRecordById = getRecordById;
    </script>
    <script>
        document.getElementById('evacuationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Animation for form submission
            const button = document.querySelector('.submit-btn');
            const originalText = button.textContent;
            
            button.textContent = '×©×•×œ×—...';
            button.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
            
            // Collect form data
                const formData = {
                    idNumber: document.getElementById('idNumber').value,
                    isMissing: document.getElementById('isMissing').checked,
                    name: document.getElementById('name').value,
                    street: document.getElementById('street').value,
                    houseNumber: document.getElementById('houseNumber').value,
                    apartmentNumber: document.getElementById('apartmentNumber').value,
                    floor: document.getElementById('floor').value,
                    residents: document.getElementById('residents').value,
                    familyMissing: document.getElementById('familyMissing').value === 'true',
                    clothing: document.getElementById('clothing').value,
                    additionalFamily: document.getElementById('additionalFamily').value,
                    mobilePhone: document.getElementById('mobilePhone').value,
                    emergencyPhone: document.getElementById('emergencyPhone').value,
                    homePhone: document.getElementById('homePhone').value,
                    submissionDate: new Date().toLocaleString('he-IL')
                };
            
            try {
                // Send data to Google Sheets via our service
                const response = await appendToSheet(formData);
                
                if (response.status === 200) {
                    button.textContent = '× ×©×œ×— ×‘×”×¦×œ×—×”! âœ…';
                    
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
                        
                        // Show success message
                        alert('×”×˜×•×¤×¡ × ×©×œ×— ×‘×”×¦×œ×—×”! ×”× ×ª×•× ×™× × ×©××¨×• ×‘×××’×¨ ×”× ×ª×•× ×™×.');
                        
                        // Reset form
                        document.getElementById('evacuationForm').reset();
                    }, 2000);
                } else {
                    throw new Error('×©×’×™××” ×‘×©×œ×™×—×ª ×”× ×ª×•× ×™×');
                }
            } catch (error) {
                button.textContent = '×©×’×™××” ×‘×©×œ×™×—×” âŒ';
                button.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
                }, 3000);
                
                alert('×©×’×™××” ×‘×©×œ×™×—×ª ×”×˜×•×¤×¡. ×× × × ×¡×” ×©×•×‘.');
                console.error('Error:', error);
            }
        });

        // ID number validation and auto-fill
        document.getElementById('idNumber').addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '');
        });

        document.getElementById('idNumber').addEventListener('blur', async function(e) {
            const idNumber = this.value.trim();
            
            if (idNumber.length >= 5 && idNumber.length <= 9) {
                // Show loading indicator
                const loadingIndicator = document.createElement('div');
                loadingIndicator.id = 'loadingIndicator';
                loadingIndicator.style.cssText = `
                    position: absolute;
                    top: 50%;
                    right: 15px;
                    transform: translateY(-50%);
                    color: #667eea;
                    font-size: 0.9rem;
                `;
                loadingIndicator.textContent = '××—×¤×© ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™×...';
                this.parentElement.style.position = 'relative';
                this.parentElement.appendChild(loadingIndicator);
                
                try {
                    // Search for ID in Google Sheets
                    console.log('Searching for ID:', idNumber);
                    const matchingRecord = await getRecordById(idNumber);
                    console.log('Search result:', matchingRecord);
                        
                        if (matchingRecord) {
                            console.log('Found matching record:', matchingRecord);
                            
                            // Auto-fill form with found data (but don't submit automatically)
                            if (matchingRecord.name) {
                                document.getElementById('name').value = matchingRecord.name.trim();
                                console.log('Filled name:', matchingRecord.name);
                            }
                            if (matchingRecord.street) {
                                document.getElementById('street').value = matchingRecord.street.trim();
                                console.log('Filled street:', matchingRecord.street);
                            }
                            if (matchingRecord.houseNumber) {
                                document.getElementById('houseNumber').value = matchingRecord.houseNumber.toString().trim();
                                console.log('Filled house number:', matchingRecord.houseNumber);
                            }
                            if (matchingRecord.apartmentNumber && matchingRecord.apartmentNumber !== '0') {
                                document.getElementById('apartmentNumber').value = matchingRecord.apartmentNumber.toString().trim();
                                console.log('Filled apartment:', matchingRecord.apartmentNumber);
                            }
                            if (matchingRecord.floor) {
                                document.getElementById('floor').value = matchingRecord.floor.toString().trim();
                                console.log('Filled floor:', matchingRecord.floor);
                            }
                            if (matchingRecord.mobilePhone && matchingRecord.mobilePhone.trim() !== '') {
                                document.getElementById('mobilePhone').value = matchingRecord.mobilePhone.trim();
                                console.log('Filled mobile:', matchingRecord.mobilePhone);
                            }
                            if (matchingRecord.homePhone && matchingRecord.homePhone.trim() !== '') {
                                document.getElementById('homePhone').value = matchingRecord.homePhone.trim();
                                console.log('Filled home phone:', matchingRecord.homePhone);
                            }
                            if (matchingRecord.emergencyPhone && matchingRecord.emergencyPhone.trim() !== '') {
                                document.getElementById('emergencyPhone').value = matchingRecord.emergencyPhone.trim();
                                console.log('Filled emergency phone:', matchingRecord.emergencyPhone);
                            }
                            if (matchingRecord.homePhone && matchingRecord.homePhone.trim() !== '') {
                                document.getElementById('homePhone').value = matchingRecord.homePhone.trim();
                                console.log('Filled home phone:', matchingRecord.homePhone);
                            }
                            
                            // Show success message - form is filled but user must click submit button
                            showNotification(`× ××¦××• × ×ª×•× ×™× ×¢×‘×•×¨: ${matchingRecord.name || '××©×ª××©'} - ×”×˜×•×¤×¡ ××•×œ× ××•×˜×•××˜×™×ª! ×œ×—×¥ ×¢×œ "×©×œ×— ×˜×•×¤×¡" ×›×“×™ ×œ×©×œ×•×— âœ…`, 'success');
                            
                            // Highlight filled fields with animation
                            const allInputs = document.querySelectorAll('input');
                            allInputs.forEach(input => {
                                if (input.id !== 'idNumber' && input.value.trim() !== '') {
                                    input.style.background = '#e8f5e8';
                                    input.style.borderColor = '#27ae60';
                                    input.style.transform = 'scale(1.02)';
                                    setTimeout(() => {
                                        input.style.background = '';
                                        input.style.borderColor = '';
                                        input.style.transform = '';
                                    }, 3000);
                                }
                            });
                            
                        } else {
                            console.log('No matching record found for ID:', idNumber);
                            showNotification('×œ× × ××¦××• × ×ª×•× ×™× ×§×™×™××™× ×¢×‘×•×¨ ×ª×¢×•×“×ª ×–×”×•×ª ×–×• - ×× × ××œ× ××ª ×”×¤×¨×˜×™× ×™×“× ×™×ª', 'info');
                        }
                } catch (error) {
                    console.error('Error searching for ID:', error);
                    showNotification('×©×’×™××” ×‘×—×™×¤×•×© × ×ª×•× ×™× - ×× × ×‘×“×•×§ ××ª ×”×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜ ×•× ×¡×” ×©×•×‘', 'error');
                } finally {
                    // Remove loading indicator
                    const indicator = document.getElementById('loadingIndicator');
                    if (indicator) {
                        indicator.remove();
                    }
                }
            } else if (idNumber.length > 0) {
                showNotification('××¡×¤×¨ ×ª×¢×•×“×ª ×–×”×•×ª ×—×™×™×‘ ×œ×”×›×™×œ ×‘×™×Ÿ 5-9 ×¡×¤×¨×•×ª', 'error');
            }
        });

        function showNotification(message, type) {
            // Remove existing notifications
            const existingNotification = document.getElementById('notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            const notification = document.createElement('div');
            notification.id = 'notification';
            notification.textContent = message;
            
            const colors = {
                success: { bg: '#d4edda', text: '#155724', border: '#c3e6cb' },
                error: { bg: '#f8d7da', text: '#721c24', border: '#f5c6cb' },
                info: { bg: '#d1ecf1', text: '#0c5460', border: '#bee5eb' }
            };
            
            const color = colors[type] || colors.info;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${color.bg};
                color: ${color.text};
                border: 1px solid ${color.border};
                padding: 15px 20px;
                border-radius: 8px;
                font-weight: 500;
                z-index: 2000;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                animation: slideIn 0.3s ease;
            `;
            
            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideIn 0.3s ease reverse';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 4000);
        }

        // Phone number formatting
        const phoneInputs = document.querySelectorAll('input[type="tel"]');
        phoneInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                this.value = this.value.replace(/\D/g, '');
            });
        });
    </script>
</body>
</html>
